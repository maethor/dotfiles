#SHELL="/bin/bash"
#DEFAULT=$HOME/.maildir/
MAILDIR=$HOME/Maildir/

TO=""

logfile "$HOME/Maildir/maildrop.log"

###########################################################
# Persos
if(/^Delivered-To: (baal|maethor|guillaume)@(jarvis\.)?subiron\.org/)
	TO=INBOX.$MATCH1

###########################################################
# Server notification mails
if(/^(Delivered-)?To: (.*<)?(logcheck|root|apticron)@(.*)\.(open-lux|aquilenet|subiron)\.(org|fr|com)>?$/)
	TO=servers.$MATCH5.$MATCH4

if(/^Delivered-To: maethor\+server\.(.*)\.(.*)\.(.*)@jarvis\.subiron\.org$/)
 TO=servers.$MATCH3.$MATCH2.$MATCH1

###########################################################
# list.domain.suffix mailing lists : april.org, rmll.info
# liste dynamique. Ã  supprimer si tu n'en as pas besoin
if(/^List-Id: (.*<)?(.*)\.(.*)\.(.*)>?/)
	TO=lists.$MATCH3.$MATCH2

###########################################################
# abul mailing lists
if(/^List-Id: .*<(.*)\.abul\.org>/)
	TO=lists.abul.$MATCH1

###########################################################
# aquilenet mailing lists
if(/^List-Id: .*<(.*)\.listes.aquilenet.fr>/)
    TO=lists.aquilenet.$MATCH1

###########################################################
# Aquilenet
if(/^Delivered-To: maethor\+aquilenet@(jarvis\.)?.subiron.org$/)
    TO=INBOX.Aquilenet

###########################################################
# TODO
if(/^Delivered-To: maethor\+todo@(jarvis\.)?subiron\.org$/)
	TO=INBOX.TODO

###########################################################
# trashing spammed mails
#if(/^X-Spam-Status: YES/ || /^X-Spam-Level: \*{5,}/ || /^X-CRM114-Status: SPAM/)
#	TO=INBOX.Junk

FOLDER=$MAILDIR.$TO

`test -d "$FOLDER"`
if($RETURNCODE != 0)
{
	`mkdir -p $FOLDER`
	`rmdir $FOLDER`
	`/usr/bin/maildirmake $FOLDER`
	`echo $TO >> $MAILDIR/subscriptions`
}

to $FOLDER/
